# Сессии

- [Настройка](#configuration)
- [Использование сессий](#session-usage)
- [Flash данные](#flash-data)
- [Сессии в базе данных](#database-sessions)
- [Драйверы сессий](#session-drivers)

<a name="configuration"></a>
## Настройка

Поскольку HTTP не может сохранять состояние,сеансы предоставляют возможность хранить информацию о пользователе между запросами. Lumen как и Laravel предоставляет унифицированное, единое API для работы с сессиями и позволяет работать с такими механизмами как  [Memcached](http://memcached.org), [Redis](http://redis.io), базы данных как говорится "из коробки".

Драйвер сессии управляется с помощью опции `SESSION_DRIVER` в вашем конфигурационном файле `.env` . По умолчанию, Lumen настроен на использование `memcached` драйвера, который будет хорошо работать в большинстве приложений.

> **Примечание:** Не забудьте расскомментировать строчку`Dotenv::load()` в файле `bootstrap/app.php` для того, что бы Lumen подхватил файл `.env`

Перед использованием драйвера Redis в Lumen, вам необходимо добавить в зависимости пакет `predis/predis` (~1.0) и пакет  `illuminate/redis` (~5.0) в Composer.

#### Зарезервированные ключи

Lumen для своих целей использует ключ `flash` внутри сессий, так что вы не должны добавлять элемент с таким в сессии с таким же именем.

<a name="session-usage"></a>
## Использование сессий

#### Активация сессий

> **Примечание:** Перед использованием сессий вам необходимо расскомментировать `$app->middleware()` в файле `bootstrap/app.php`.

#### Доступ к сессиям

Получить доступ к сессиям можно несколькими способами, это посредством HTTP запроса метода `session`, фасада `Session`, или вспомогательной функции (хелпера) `session`. Если хелпер `session` вызывается без аргументов, то он будет возвращать весь объект сессии. Например:

	session()->regenerate();

#### Хранение переменной в сессии

	Session::put('key', 'value');

	session(['key' => 'value']);

#### Добавление элемента к массиву сессии

	Session::push('user.teams', 'developers');

#### Получение переменной из сессии

	$value = Session::get('key');

	$value = session('key');

#### Получение переменной или значения по умолчанию

	$value = Session::get('key', 'default');

	$value = Session::get('key', function() { return 'default'; });

#### Получение переменной с последующим удалением из сессии

	$value = Session::pull('key', 'default');

#### Получение всех данных из сессии

	$data = Session::all();

#### Проверка существования переменной

	if (Session::has('users')) {
		//
	}

#### Удаление переменной из сессии

	Session::forget('key');

#### Удаление всех переменных из сессии

	Session::flush();

#### Регенерация идентификатора сессии

	Session::regenerate();

<a name="flash-data"></a>
## Flash данные

Иногда необходимо хранить переменные в сессии только для следующего запроса, в этом вам поможет метод `Session::flash`:

	Session::flash('key', 'value');

#### Переопределение Flash данных для следующего запроса

Если необходимо сохранить все текущие flash данные для следующего запроса, используйте следующий метод:

	Session::reflash();

#### Переопределение Flash данных для следующего запроса и только конкретного ключа

	Session::keep(['username', 'email']);

<a name="database-sessions"></a>
## Сессии в базе данных

При использовании драйвера сессий `database`, вам необходимо создать таблицу. Ниже находится пример `Schema` c требуемыми колонками таблицы:

	Schema::create('sessions', function($table)
	{
		$table->string('id')->unique();
		$table->text('payload');
		$table->integer('last_activity');
	});

<a name="session-drivers"></a>
## Драйверы сессий

За определение где механизм работы с сессиями будет хранить данные отвечает "драйвер" сессий. Lumen как и Laravel предоставляет унифицированное, единое API для работы с сессиями и позволяет работать различными драйверами:

- `file` - сессии будут сохранены в `storage/framework/sessions`.
- `cookie` - сессии будут храниться в зашифрованных куках.
- `database` - сессии будут храниться в базе данных.
- `memcached` / `redis` - сессии будут храниться в быстрых хранилищах.
- `array` - Сессии будут храниться в простом массиве PHP и не будут сохраняться между запросами.
